{"ast":null,"code":"import _defineProperty from \"/Users/wuyanqiang/Documents/h5/zqplayer-admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/wuyanqiang/Documents/h5/zqplayer-admin/src/routes/index.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/**\n * Created by 叶子 on 2017/8/13.\n */\nimport React, { Component } from 'react';\nimport { Route, Redirect, Switch } from 'react-router-dom';\nimport DocumentTitle from 'react-document-title';\nimport AllComponents from '../components';\nimport routesConfig from './config';\nimport queryString from 'query-string';\nimport { checkLogin } from '../utils';\nexport default class CRouter extends Component {\n  constructor(...args) {\n    super(...args);\n\n    this.getPermits = () => {\n      const auth = this.props.auth;\n      return auth ? auth.data.permissions : null;\n    };\n\n    this.requireAuth = (permit, component) => {\n      const permits = this.getPermits(); // const { auth } = store.getState().httpData;\n\n      if (!permits || !permits.includes(permit)) return React.createElement(Redirect, {\n        to: '404',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 25\n        },\n        __self: this\n      });\n      return component;\n    };\n\n    this.requireLogin = (component, permit) => {\n      const permits = this.getPermits();\n\n      if (!checkLogin(permits)) {\n        // 线上环境判断是否登录\n        return React.createElement(Redirect, {\n          to: '/login',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 32\n          },\n          __self: this\n        });\n      }\n\n      return permit ? this.requireAuth(permit, component) : component;\n    };\n\n    this.createRoute = key => {\n      return routesConfig[key].map(r => {\n        const route = r => {\n          const Component = r.component && AllComponents[r.component];\n          return React.createElement(Route, {\n            key: r.route || r.key,\n            exact: true,\n            path: r.route || r.key,\n            render: props => {\n              const reg = /\\?\\S*/g; // 匹配?及其以后字符串\n\n              const queryParams = window.location.hash.match(reg); // 去除?的参数\n\n              const params = props.match.params;\n              Object.keys(params).forEach(key => {\n                params[key] = params[key] && params[key].replace(reg, '');\n              });\n              props.match.params = _objectSpread({}, params);\n\n              const merge = _objectSpread({}, props, {\n                query: queryParams ? queryString.parse(queryParams[0]) : {}\n              }); // 重新包装组件\n\n\n              const wrappedComponent = React.createElement(DocumentTitle, {\n                title: r.title,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 62\n                },\n                __self: this\n              }, React.createElement(Component, Object.assign({}, merge, {\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 63\n                },\n                __self: this\n              })));\n              return r.login ? wrappedComponent : this.requireLogin(wrappedComponent, r.requireAuth);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 42\n            },\n            __self: this\n          });\n        };\n\n        const subRoute = r => r.subs && r.subs.map(subR => subR.subs ? subRoute(subR) : route(subR));\n\n        return r.component ? route(r) : subRoute(r);\n      });\n    };\n  }\n\n  render() {\n    return React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, Object.keys(routesConfig).map(key => this.createRoute(key)), React.createElement(Route, {\n      render: () => React.createElement(Redirect, {\n        to: \"/404\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85\n        },\n        __self: this\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }));\n  }\n\n}","map":{"version":3,"sources":["/Users/wuyanqiang/Documents/h5/zqplayer-admin/src/routes/index.tsx"],"names":["React","Component","Route","Redirect","Switch","DocumentTitle","AllComponents","routesConfig","queryString","checkLogin","CRouter","getPermits","auth","props","data","permissions","requireAuth","permit","component","permits","includes","requireLogin","createRoute","key","map","r","route","reg","queryParams","window","location","hash","match","params","Object","keys","forEach","replace","merge","query","parse","wrappedComponent","title","login","subRoute","subs","subR","render"],"mappings":"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","sourcesContent":["/**\n * Created by 叶子 on 2017/8/13.\n */\nimport React, { Component } from 'react';\nimport { Route, Redirect, Switch } from 'react-router-dom';\nimport DocumentTitle from 'react-document-title';\nimport AllComponents from '../components';\nimport routesConfig, { IFMenuBase, IFMenu } from './config';\nimport queryString from 'query-string';\nimport { checkLogin } from '../utils';\n\ntype CRouterProps = {\n    auth: any;\n};\n\nexport default class CRouter extends Component<CRouterProps> {\n    getPermits = (): any[] | null => {\n        const { auth } = this.props;\n        return auth ? auth.data.permissions : null;\n    };\n\n    requireAuth = (permit: any, component: React.ReactElement) => {\n        const permits = this.getPermits();\n        // const { auth } = store.getState().httpData;\n        if (!permits || !permits.includes(permit)) return <Redirect to={'404'} />;\n        return component;\n    };\n    requireLogin = (component: React.ReactElement, permit: any) => {\n        const permits = this.getPermits();\n        if (!checkLogin(permits)) {\n            // 线上环境判断是否登录\n            return <Redirect to={'/login'} />;\n        }\n        return permit ? this.requireAuth(permit, component) : component;\n    };\n\n    createRoute = (key: string) => {\n        return routesConfig[key].map((r: IFMenu) => {\n            const route = (r: IFMenuBase) => {\n                const Component = r.component && AllComponents[r.component];\n                return (\n                    <Route\n                        key={r.route || r.key}\n                        exact\n                        path={r.route || r.key}\n                        render={props => {\n                            const reg = /\\?\\S*/g;\n                            // 匹配?及其以后字符串\n                            const queryParams = window.location.hash.match(reg);\n                            // 去除?的参数\n                            const { params } = props.match;\n                            Object.keys(params).forEach(key => {\n                                params[key] = params[key] && params[key].replace(reg, '');\n                            });\n                            props.match.params = { ...params };\n                            const merge = {\n                                ...props,\n                                query: queryParams ? queryString.parse(queryParams[0]) : {},\n                            };\n                            // 重新包装组件\n                            const wrappedComponent = (\n                                <DocumentTitle title={r.title}>\n                                    <Component {...merge} />\n                                </DocumentTitle>\n                            );\n                            return r.login\n                                ? wrappedComponent\n                                : this.requireLogin(wrappedComponent, r.requireAuth);\n                        }}\n                    />\n                );\n            };\n\n            const subRoute = (r: IFMenu): any =>\n                r.subs && r.subs.map((subR: IFMenu) => (subR.subs ? subRoute(subR) : route(subR)));\n\n            return r.component ? route(r) : subRoute(r);\n        });\n    };\n\n    render() {\n        return (\n            <Switch>\n                {Object.keys(routesConfig).map(key => this.createRoute(key))}\n                <Route render={() => <Redirect to=\"/404\" />} />\n            </Switch>\n        );\n    }\n}\n"]},"metadata":{},"sourceType":"module"}